% Always typeset math in display style
\everymath{\displaystyle}

% Standard mathematical typesetting packages
\usepackage[T1]{fontenc}
\usepackage{amsthm, amsmath, amssymb}
\DeclareMathSymbol{\shortminus}{\mathbin}{AMSa}{"39}
\usepackage[fixamsmath]{mathtools}  % Extension to amsmath
\usepackage[cal=cm, scr=rsfs, frak=euler, bb=ams]{mathalpha}
\usepackage{lmodern}

% Symbol and utility packages
\usepackage{cancel}
\usepackage[nointegrals]{wasysym}

% Extras
\usepackage{mleftright}
\mleftright
\usepackage{physics}  % Lots of useful shortcuts and macros
\usepackage{quiver}  % For drawing commutative diagrams easily
\usetikzlibrary{angles}
\usetikzlibrary{positioning} % For relative position of tikz nodes
\usepackage{microtype}  % Minature font tweaks
\usepackage{polynom}

\usepackage{hwemoji}  % Support Unicode emojis
\DeclareUnicodeCharacter{FE0E}{}
\DeclareUnicodeCharacter{FE0F}{}

% Common shortcuts
\def\mbb#1{\mathbb{#1}}
\def\mfk#1{\mathfrak{#1}}

\def\N{\mbb{N}}
\def\C{\mbb{C}}
\def\R{\mbb{R}}
\def\pr{\mbb{P}}
\def\Q{\mbb{Q}}
\def\Z{\mbb{Z}}

\def\la{\leftarrow}
\def\La{\Leftarrow}
\def\ra{\rightarrow}
\def\Ra{\Rightarrow}
\def\lp{\left(}
\def\rp{\right)}
\def\lk{\left[}
\def\rk{\right]}
\def\lb{\left\{}
\def\rb{\right\}}

\def\del{\nabla}
\def\eps{\varepsilon}
\def\inv{{-1}}
\def\pa{\partial}
\def\vp{\varphi}
\def\y{\infty}
\def\th{\theta}

% Sometimes helpful macros
\newcommand{\pdif}[3]{\frac{\partial^{#3}#1}{\partial#2^{#3}}}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}

\ExplSyntaxOn
\char_set_catcode_letter:n { `\@ }

%-------------------------------------------------------------------------------
% factoids
%-------------------------------------------------------------------------------

\tl_const:Nn \c__factoids_path_separator_tl { / }
\tl_const:Nn \c__factoids_path_default_tl   { . }

\tl_new:N \l__factoids_tmpa_tl

\seq_new:N   \l__factoids_path_default_seq
\seq_clear:N \l__factoids_path_default_seq

\seq_new:N \l__factoids_path_seq
\tl_new:N  \l__factoids_path_tl
\seq_new:N \l__factoids_path_builder_seq
\tl_new:N  \l__factoids_path_suffix_seq
\tl_new:N  \l__factoids_path_head_tl
\tl_new:N  \l__factoids_path_last_tl

\tl_new:N   \l__factoids_bundle_tl
\bool_new:N \l__factoids_bundle_interamble_bool

\seq_new:N \l__factoids_paths_search_seq

%-------------------------------------------------------------------------------

\cs_generate_variant:Nn \seq_set_split:Nnn { NVn, NVV }
\cs_generate_variant:Nn \seq_use:Nn { NV }
\cs_generate_variant:Nn \tl_concat:NNN { NNc }

\cs_new:Npn \__factoids_path_format:N #1
  { \seq_use:NV #1 \c__factoids_path_separator_tl }

\cs_new:Npn \__factoids_path_cs:N #1
  { ~>~ / \__factoids_path_format:N #1 / ~>~ }

\cs_new_protected:Npn \__factoids_path_set_split:Nn #1#2
  {
    \seq_set_split:NVn #1 \c__factoids_path_separator_tl {#2}
  }
\cs_generate_variant:Nn \__factoids_path_set_split:Nn { NV }

\cs_new_protected:Npn \__factoids_path_prepend_default:N #1
  {
    \seq_get_left:NN #1 \l__factoids_path_head_tl
    \tl_if_eq:NNT \l__factoids_path_head_tl \c__factoids_path_default_tl
      {
        \seq_pop_left:NN #1 \l__factoids_tmpa_tl
        \seq_concat:NNN #1 \l__factoids_path_default_seq #1
      }
  }

%-------------------------------------------------------------------------------
% default path
%-------------------------------------------------------------------------------

\cs_new_protected:Npn \__factoids_path_default_push:n #1
  {
    \group_begin:
      \__factoids_path_set_split:Nn \l__factoids_path_seq {#1}
      \__factoids_path_prepend_default:N \l__factoids_path_seq
      \seq_set_eq:NN \l__factoids_path_default_seq \l__factoids_path_seq
  }

\cs_new_protected:Npn \__factoids_path_default_pop:
  {
    \group_end:
  }

%-------------------------------------------------------------------------------
% factoid creation
%-------------------------------------------------------------------------------

\cs_new_protected:Npn \__factoids_dir_new:
  {
    % quick path
    \seq_if_exist:cT
      { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _dirs_seq }
      { \prg_break: }

    \seq_clear:N \l__factoids_path_builder_seq

    % create dir if doesn't exist
    \seq_if_exist:cF
      { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _dirs_seq }
      {
        \seq_new:c { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _dirs_seq }
        \seq_new:c { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _entries_seq }
        \seq_new:c { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _bundles_seq }
      }

    \bool_while_do:nn { !\seq_if_empty_p:N \l__factoids_path_seq }
      {
        \seq_pop_left:NN \l__factoids_path_seq \l__factoids_path_head_tl
        \seq_put_right:NV \l__factoids_path_builder_seq \l__factoids_path_head_tl
        \seq_if_exist:cF
          { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _dirs_seq }
          {
            % insert
            \group_begin:
              \seq_pop_right:NN \l__factoids_path_builder_seq \l__factoids_tmpa_tl
              \seq_gput_right:cV
                { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _dirs_seq }
                \l__factoids_path_head_tl
            \group_end:

            \seq_new:c { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _dirs_seq }
            \seq_new:c { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _entries_seq }
            \seq_new:c { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _bundles_seq }
          }
      }

    % restore \l__factoids_path_seq
    \seq_set_eq:NN \l__factoids_path_seq \l__factoids_path_builder_seq

    \prg_break_point:
  }

\cs_new_protected:Npn \__factoids_dir_new:n #1
  {
    \__factoids_path_set_split:Nn \l__factoids_path_seq {#1}
    \__factoids_path_prepend_default:N \l__factoids_path_seq
    \__factoids_dir_new:
  }

% TODO: error handling if seq is empty
% TODO: checking existence of entry
% dir cs, entry cs, err msg 1, err msg 2, path, definition
\cs_new_protected:Npn \__factoids_entry_new:nnnnnn #1#2#3#4#5#6
  {
    \__factoids_path_set_split:Nn \l__factoids_path_seq {#5}
    \__factoids_path_prepend_default:N \l__factoids_path_seq

    \tl_if_exist:cT
      { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _#2_tl }
      {
        \msg_error:nnxxxx { __factoids } { already-defined }
          { #3 } { #4 }
          { \__factoids_path_format:N \l__factoids_path_seq }
          {
            \token_to_meaning:c { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _#2_tl }
          }
        \cs_undefine:c
          { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _#2_tl }
      }

    \seq_pop_right:NN \l__factoids_path_seq \l__factoids_path_last_tl
    \__factoids_dir_new:

    \seq_gput_right:cV
      { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _#1_seq }
      \l__factoids_path_last_tl
    \seq_put_right:NV \l__factoids_path_seq \l__factoids_path_last_tl

    \tl_new:c   { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _#2_tl }
    \tl_gset:cn { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _#2_tl } {#6}
  }

\cs_new_protected:Npn \__factoids_entry_new:nn #1#2
  {
    \__factoids_entry_new:nnnnnn
      { entries } { entry }
      { Factoid } { factoid }
      {#1} {#2}
  }

\cs_new_protected:Npn \__factoids_bundle_new:nn #1#2
  {
    \__factoids_entry_new:nnnnnn
      { bundles } { bundle }
      { Factoid~ bundle~ entry } { factoid~ bundle~ entry }
      {#1} {#2}
  }

% TODO: error handling if seq is empty
% TODO: checking existence of entry
% entry cs, err msg 1, err msg 2, path, definition
\cs_new_protected:Npn \__factoids_bundle_xamble_new:nnnnn #1#2#3#4#5
  {
    \__factoids_path_set_split:Nn \l__factoids_path_seq {#4}
    \__factoids_path_prepend_default:N \l__factoids_path_seq

    \tl_if_exist:cT
      { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _#1_tl }
      {
        \msg_error:nnxxxx { __factoids } { already-defined }
          { #2 } { #3 }
          { \__factoids_path_format:N \l__factoids_path_seq }
          {
            \token_to_meaning:c { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _#1_tl }
          }
        \cs_undefine:c
          { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _#1_tl }
      }

    \__factoids_dir_new:

    \tl_new:c   { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _#1_tl }
    \tl_gset:cn { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _#1_tl } {#5}
  }

\cs_new_protected:Npn \__factoids_bundle_preamble_new:nn #1#2
  {
    \__factoids_bundle_xamble_new:nnnnn
      { bundle_preamble }
      { Factoid~ bundle~ preamble } { factoid~ bundle~ preamble }
      {#1} {#2}
  }

\cs_new_protected:Npn \__factoids_bundle_interamble_new:nn #1#2
  {
    \__factoids_bundle_xamble_new:nnnnn
      { bundle_interamble }
      { Factoid~ bundle~ interamble } { factoid~ bundle~ interamble }
      {#1} {#2}
  }

\cs_new_protected:Npn \__factoids_bundle_postamble_new:nn #1#2
  {
    \__factoids_bundle_xamble_new:nnnnn
      { bundle_postamble }
      { Factoid~ bundle~ postamble } { factoid~ bundle~ postamble }
      {#1} {#2}
  }

%-------------------------------------------------------------------------------
% factoid invocation
%-------------------------------------------------------------------------------

% path, entry, bundle, dir/bundles, otherwise
\cs_new_protected:Npn \__factoids_invoke_check_alternatives:nnnnn #1#2#3#4#5
  {
    % valid entry name
    \tl_if_exist:cT
      { g__factoids_ \__factoids_path_cs:N #1 _entry_tl }
      { \prg_break:n {#2} }

    % valid bundle name
    \tl_if_exist:cT
      { g__factoids_ \__factoids_path_cs:N #1 _bundle_tl }
      { \prg_break:n {#3} }

    % valid dir with bundles
    \bool_lazy_and:nnT
      {  \seq_if_exist_p:c { g__factoids_ \__factoids_path_cs:N #1 _bundles_seq } }
      { !\seq_if_empty_p:c { g__factoids_ \__factoids_path_cs:N #1 _bundles_seq } }
      { \prg_break:n {#4} }

    % otherwise
    #5

    \prg_break_point:
  }

% path, entry, bundle, dir/bundles
\cs_new_protected:Npn \__factoids_invoke_check_alternatives:nnnn #1#2#3#4
  {
    \__factoids_invoke_check_alternatives:nnnnn {#1} {#2} {#3} {#4} {}
  }

\cs_new_protected:Npn \__factoids_invoke:n #1
  {
    \__factoids_path_set_split:Nn \l__factoids_path_seq {#1}
    \__factoids_path_prepend_default:N \l__factoids_path_seq

    \__factoids_invoke_aux:Nn \l__factoids_path_seq
      {
        \msg_error:nnx { __factoids } { not-defined }
          { \__factoids_path_format:N \l__factoids_path_seq }
        % TODO: error reporting
      }
  }

\cs_new_protected:Npn \__factoids_invoke_aux:Nn #1#2
  {
    \__factoids_invoke_check_alternatives:nnnnn { #1 }
      {
        \tl_use:c { g__factoids_ \__factoids_path_cs:N #1 _entry_tl }
      }
      {
        % build bundle
        \tl_clear:N \l__factoids_bundle_tl
        \seq_set_eq:NN \l__factoids_path_builder_seq #1
        \seq_pop_right:NN \l__factoids_path_builder_seq \l__factoids_tmpa_tl

        % preamble
        \tl_if_exist:cT
          { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _bundle_preamble_tl }
          {
            \tl_concat:NNc \l__factoids_bundle_tl \l__factoids_bundle_tl
              { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _bundle_preamble_tl }
          }
        % body
        \tl_concat:NNc \l__factoids_bundle_tl \l__factoids_bundle_tl
          { g__factoids_ \__factoids_path_cs:N #1 _bundle_tl }
        % postamble
        \tl_if_exist:cT
          { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _bundle_postamble_tl }
          {
            \tl_concat:NNc \l__factoids_bundle_tl \l__factoids_bundle_tl
              { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _bundle_postamble_tl }
          }

        \tl_use:N \l__factoids_bundle_tl
      }
      {
        % build bundle
        \tl_clear:N \l__factoids_bundle_tl
        \bool_set_false:N \l__factoids_bundle_interamble_bool

        % preamble
        \tl_if_exist:cT
          { g__factoids_ \__factoids_path_cs:N #1 _bundle_preamble_tl }
          {
            \tl_concat:NNc \l__factoids_bundle_tl \l__factoids_bundle_tl
              { g__factoids_ \__factoids_path_cs:N #1 _bundle_preamble_tl }
          }

        % main body
        \seq_map_inline:cn { g__factoids_ \__factoids_path_cs:N #1 _bundles_seq }
          {
            % interamble
            \bool_if:nT
              {
                \l__factoids_bundle_interamble_bool
                && \tl_if_exist_p:c { g__factoids_ \__factoids_path_cs:N #1 _bundle_interamble_tl }
              }
              {
                \tl_concat:NNc \l__factoids_bundle_tl \l__factoids_bundle_tl
                  { g__factoids_ \__factoids_path_cs:N #1 _bundle_interamble_tl }
              }
            \bool_set_true:N \l__factoids_bundle_interamble_bool

            \seq_set_eq:NN \l__factoids_path_builder_seq #1
            \seq_put_right:Nn \l__factoids_path_builder_seq {##1}
            \tl_concat:NNc \l__factoids_bundle_tl \l__factoids_bundle_tl
              { g__factoids_ \__factoids_path_cs:N \l__factoids_path_builder_seq _bundle_tl }
          }

        % postamble
        \tl_if_exist:cT
          { g__factoids_ \__factoids_path_cs:N #1 _bundle_postamble_tl }
          {
            \tl_concat:NNc \l__factoids_bundle_tl \l__factoids_bundle_tl
              { g__factoids_ \__factoids_path_cs:N #1 _bundle_postamble_tl }
          }

        \tl_use:N \l__factoids_bundle_tl
      }
      {#2}

    \tex_ignorespaces:D
  }

\cs_new_protected:Npn \__factoids_invoke_aux:N #1
  {
    \__factoids_invoke_aux:Nn #1 {}
  }

% does not prepend default path
\cs_new_protected:Npn \__factoids_invoke_fuzzy:n #1
  {
    \__factoids_path_set_split:Nn \l__factoids_path_seq {#1}
    \__factoids_invoke_aux:Nn \l__factoids_path_seq
      { \__factoids_invoke_fuzzy_search: }
  }

\cs_new_protected:Npn \__factoids_invoke_fuzzy_search:
  {
    \seq_set_eq:NN \l__factoids_path_suffix_seq \l__factoids_path_seq
    \seq_clear:N \l__factoids_path_seq
    \seq_clear:N \l__factoids_paths_search_seq

    \__factoids_invoke_fuzzy_search_rec:

    \int_case:nnF { \seq_count:N \l__factoids_paths_search_seq }
      {
        { 0 }
          {
            % TODO: error reporting
            % undefined
            \msg_error:nnx { __factoids } { not-defined }
              { \__factoids_path_format:N \l__factoids_path_suffix_seq }
          }
        { 1 }
          {
            \seq_pop_left:NN \l__factoids_paths_search_seq \l__factoids_path_tl
            \__factoids_path_set_split:NV \l__factoids_path_seq \l__factoids_path_tl
            \__factoids_invoke_aux:N \l__factoids_path_seq
          }
      }
      {
        % TODO: error reporting
        % too many matches
        \msg_error:nnxx { __factoids } { too-many-matches }
          { \__factoids_path_format:N \l__factoids_path_suffix_seq }
          {
            '
            \seq_use:Nnnn \l__factoids_paths_search_seq
              { '~ and~ ' } { ',~ ' } { ',~ and~ ' }
            '
          }
      }
  }

\cs_new_protected:Npn \__factoids_invoke_fuzzy_search_rec:
  {
    \seq_set_eq:NN \l__factoids_path_builder_seq \l__factoids_path_seq
    \seq_concat:NNN \l__factoids_path_builder_seq \l__factoids_path_builder_seq \l__factoids_path_suffix_seq

    \__factoids_invoke_check_alternatives:nnnn { \l__factoids_path_builder_seq }
      {
        \seq_put_right:Nx \l__factoids_paths_search_seq
          { \__factoids_path_format:N \l__factoids_path_builder_seq }
      }
      {
        \seq_put_right:Nx \l__factoids_paths_search_seq
          { \__factoids_path_format:N \l__factoids_path_builder_seq }
      }
      {
        \seq_put_right:Nx \l__factoids_paths_search_seq
          { \__factoids_path_format:N \l__factoids_path_builder_seq }
      }

    \seq_map_inline:cn { g__factoids_ \__factoids_path_cs:N \l__factoids_path_seq _dirs_seq }
      {
        \seq_put_right:Nn \l__factoids_path_seq {##1}
        \__factoids_invoke_fuzzy_search_rec:
        \seq_pop_right:NN \l__factoids_path_seq \l__factoids_tmpa_tl
      }
  }

%-------------------------------------------------------------------------------
% error messages
%-------------------------------------------------------------------------------

\prop_gput:Nnn \g_msg_module_name_prop { __factoids } { factoids }
\prop_gput:Nnn \g_msg_module_type_prop { __factoids } {}

% \msg_new:nnn { __factoids } { empty-name }
% 	{ Cannot~ define~ #1~ with~ an~ empty~ name. }

\msg_new:nnnn { __factoids } { already-defined }
  { #1~ '#3'~ already~ defined. }
  {
    I~ have~ been~ asked~ to~ create~ a~ new~ #2~ '#3'~
    but~ this~ name~ has~ already~ been~ used~ elsewhere. \\
    \\
    The~ current~ meaning~ is: \\
    \ \ #4 \\
    \\
    I~ am~ overwriting~ this~ definition.
  }

\msg_new:nnnn { __factoids } { not-defined }
  { Factoid~ '#1'~ not~ defined. }
  {
    I~ have~ been~ asked~ to~ use~ a~ factoid~ '#1': \\
    this~ has~ not~ been~ defined~ yet.
  }

\msg_new:nnnn { __factoids } { too-many-matches }
  { Found~ multiple~ factoids~ named~ '#1'. }
  {
    I~ have~ been~ asked~ to~ use~ a~ factoid~ '#1'~
    but~ I~ found~ more~ than~ one~ match. \\
    The~ matches~ are: \\
    \ \ #2.
  }

%-------------------------------------------------------------------------------
% L2e interface
%-------------------------------------------------------------------------------

\cs_new_protected:Npn \NewFactoid
  { \__factoids_entry_new:nn }
\cs_new_protected:Npn \NewFactoidBundle #1#2
  {
    \__factoids_path_default_push:n {#1}
      \cs_set_protected:Npn \NewPreamble
        { \__factoids_bundle_preamble_new:nn { . } }
      \cs_set_protected:Npn \NewInteramble
        { \__factoids_bundle_interamble_new:nn { . } }
      \cs_set_protected:Npn \NewPostamble
        { \__factoids_bundle_postamble_new:nn { . } }
      \cs_set_protected:Npn \NewEntry ##1
        { \__factoids_bundle_new:nn { ./##1 } }

      #2
    \__factoids_path_default_pop:
  }
\cs_new_protected:Npn \Factoid
  { \__factoids_invoke:n }
\cs_new_protected:Npn \FactoidFuzzy
  { \__factoids_invoke_fuzzy:n }
\cs_new_protected:Npn \PushDefaultFactoidPath
  { \__factoids_path_default_push:n }
\cs_new_protected:Npn \PopDefaultFactoidPath
  { \__factoids_path_default_pop: }

% legacy
\cs_new_protected:Npn \factoid
  { \__factoids_invoke:n }
\cs_new_protected:Npn \DeclareFactoid
  { \__factoids_entry_new:nn }

\ExplSyntaxOff

%-------------------------------------------------------------------------------
% L2e stuff
%-------------------------------------------------------------------------------

% getline
\begingroup
\catcode`\^^M=12\relax%
\def\@@{%
  \def\getline##1{%
    \begingroup%
    \endlinechar=`\^^M%
    \catcode`\^^M=12\relax%
    \@getline{##1}%
  }%
  \long\def\@getline##1##2^^M{%
    \endgroup%
    ##1{##2}%
  }%
}%
\expandafter\endgroup%
\@@%

\def\xgetline#1{%
  \def\@@{\getline{#1}}%
  \futurelet\@next\@xgetline%
}%
\def\@xgetline{%
  \ifx\@next\@sptoken
    \expandafter\@firstoftwo
  \else
    \expandafter\@secondoftwo
  \fi
  {\afterassignment\@@ \let\@next= }%
  {\@@}%
}%

\protected\def\.{\xgetline\FactoidFuzzy}

\ExplSyntaxOn

%-------------------------------------------------------------------------------
% automatic dot detection
%-------------------------------------------------------------------------------

\cs_new_protected:Npn \__factoids_optional_dot:w
  {
    \peek_remove_spaces:n { \peek_charcode_remove:NT . { \. } }
  }
\g@addto@macro \document \__factoids_optional_dot:w

\char_set_catcode_other:n { `\@ }
\ExplSyntaxOff

%%%%%%%%%%%%%%%%%%%%%% Begin Factoid Declaration %%%%%%%%%%%%%%%%%%%%%%

% Common instructional requests
\NewFactoid{original}{Please post original question, exactly as is. Screenshot or picture is best.}


% American High school Algebra and Geometry
\NewFactoid{algebra manipulation}{%
  \definecolor{o}{HTML}{ff7e00}
  \definecolor{b}{HTML}{00bfff}
  \definecolor{g}{HTML}{50C878}

  One of the basic principles of manipulating equations is applying the same operation to both sides of the equation. \\
  Consider the following examples with each new example builds on what was introduced in the previous example(s).\\
  { \bf{Ex1} }
  There is both an $x$ and a constant on the left side of the equation.
  $$x - 1= 3$$
  to solve for $x$ you can add 1 to both sides of the equation to get
  $$x - 1 +1= 3 + 1$$
  this separates your $x$ term from the terms without $x$ and in this example already gives you the solution
  $$x = 4$$
  { \bf{Ex2} }
  $x$ has a coefficient (something being multiplied to it)
  you can solve for $x$ by dividing both sides by the coefficient,
  in this case dividing both sides by ${\color o {3}}$
  \begin{align*}
    {\color o {3}} x &= 6 \\
    \frac{{\color o {3}} x}{\color o {3}} &= \frac{6}{{\color o {3}} } \\
    x &= 2
  \end{align*}

  { \bf{Ex3} }
  now to increase the complexity by a little and combining the two above ideas \\
  you have an $x$ term with a coefficient and a constant on the left side
  $${\color o {2}}x  - 1= 3$$
  adding 1 to both sides (applying the same idea as { \bf{Ex1} })
  $${\color o {2}}x = 4$$
  note that you now have something resembling what we started with in { \bf{Ex2} } \\
  dividing both sides by ${\color o {2}}$
  \begin{align*}
    \frac{{\color o {2}}x}{{\color o {2}}} &= \frac{4}{{\color o {2}}} \\
    x &= 2
  \end{align*}

  { \bf{Ex4} }
  now to increase the complexity by even more \\
  you now have constants and $x$ terms with coefficients on both sides of the equation
  \begin{equation*}
    { \color o 6 }x - 4 = 5 -{ \color b 3 }x
  \end{equation*}
  adding 4 to both sides
  \begin{equation*}
  { \color o 6 }x = 9 -  { \color b 3 }x
  \end{equation*}
  adding ${ \color b 3 }x$ to both sides
  \begin{equation*}
    { \color o 6 }x +  { \color b 3 }x = 9 -  { \color b 3 }x +  { \color b 3 }x
  \end{equation*}
  combining like terms
  \begin{equation*}
    { \color g 9 }x  = 9
  \end{equation*}
  dividing both sides by 9
  \begin{align*}
    \frac{{ \color g 9 }x}{{ \color g 9 }} &= \frac{9}{{ \color g 9 }}\\
    x &= 1
  \end{align*}
  if you understand all of the above, you should have little difficulty solving linear equations of a single variable. \
  different values once you have your equation makes little difference.
}
\NewFactoid{alg lesson}{\Factoid{algebra manipulation}}
\NewFactoid{alg manipulation}{\Factoid{algebra manipulation}}
\NewFactoid{alg manip}{\Factoid{algebra manipulation}}
\NewFactoid{algebra manip}{\Factoid{algebra manipulation}}
\NewFactoid{algebra lesson}{\Factoid{algebra manipulation}}

\NewFactoid{cross multiplication}{%
  $\frac{a}{b} = \frac{c}{d} \ \Ra \ a d = b c$
}
\NewFactoid{cross mult}{\Factoid{cross multiplication}}
\NewFactoid{butterfly}{\Factoid{cross multiplication}}

\NewFactoid{wrong reciprocal}{%
  $\frac{1}{x+y} = (x + y)^{-1} $ does not equal $\frac{1}{x} + \frac{1}{y}$
}
\NewFactoid{wrong recip}{\Factoid{wrong reciprocal}}

\NewFactoid{wrong square root}{%
  $\sqrt{x + y}$ does not equal $\sqrt{x} + \sqrt{y}$
}
\NewFactoid{wrong root}{\Factoid{wrong square root}}

\NewFactoid{wrong fraction cancel}{%
  $\frac{x}{x+y}$ cannot be simplified using $\frac{\cancel{x}}{\cancel{x}+y}$
}
\NewFactoid{wrong cancel}{\Factoid{wrong fraction cancel}}

\NewFactoid{wrong square}{%
  $(x + y)^2$ does not equal $x^2 + y^2$
}
\NewFactoid{freshman}{\Factoid{wrong square}}

\NewFactoid{cts}{%
  {\bfseries Completing the square}

  \medskip
  Consider:
  \[
    \left(x + \frac b2\right)^2 = x^2 + bx + \left(\frac b2\right)^2.
  \]

  Adding $\left(\frac b2\right)^2$ to $x^2 + bx$ will make it a perfect square.

  Doing so will change the value of the expression.

  However we can add and subtract $\left(\frac b2\right)^2$, which is adding $0$.
  \begin{align*}
    x^2 + bx + c & = x^2 + bx + \left(\frac b2\right)^2 + c - \left(\frac b2\right)^2 \\
    x^2 + bx + c & = \left(x + \frac b2\right)^2 + c - \left(\frac b2\right)^2
  \end{align*}%
}

\NewFactoid{absolute value def}{%
  $$\left | x \right |=
  \begin{cases}
    -x & \text{ if } x<0 \\
    x & \text{ if } x\ge0
  \end{cases}$$
}
\NewFactoid{absolute value}{\Factoid{absolute value def}}
\NewFactoid{abs def}{\Factoid{absolute value def}}
\NewFactoid{abs value}{\Factoid{absolute value def}}

\NewFactoid{quadratic formula}{%
  \begin{spreadlines}{1ex}
    \begin{alignat*}{2}
      &\textrm{The solutions to } ax^2 + bx + c = 0 \textrm{ are} \\
      &x = \frac{-b + \sqrt{b^2 - 4ac}}{2a} \ \textrm{and} \ x = \frac{-b - \sqrt{b^2 - 4ac}}{2a}
    \end{alignat*}
  \end{spreadlines}
}

\NewFactoidBundle{exp rules}{%
  \NewPreamble{%
    \begin{spreadlines}{1ex}
      \begin{alignat*}{3}
        &\textbf{Exponent Rule Name} \quad && \textbf{Property} \\
  }
  \NewInteramble{\\}
  \NewEntry{exp prod}{&\textrm{Product Rule} \quad && a^xa^y = a^{x+y}}
  \NewEntry{exp neg}{&\textrm{Negative Exponent} \quad && a^{-x}=\tfrac{1}{a^x}}
  \NewEntry{exp quotient}{&\textrm{Quotient Rule} \quad && \frac{a^x}{a^y}=a^{x-y}}
  \NewEntry{power of power}{&\textrm{Power of Power} \quad && \left(a^x\right)^y=a^{xy}}
  \NewEntry{exp distrib}{&\textrm{Distributivity} \quad && (ab)^x=a^xb^x}
  \NewEntry{exp frac}{&\textrm{Fractional Exponent} \quad && a^{\frac{x}{y}}=\sqrt[y]{a^x}}
  \NewPostamble{%
      \end{alignat*}%
    \end{spreadlines}%
  }
}

\NewFactoid{log xp rule}{\[\log_{a^b}(c^d) \equiv \frac{d}{b}\log_a(c)\]}

\NewFactoid{point slope}{%
  For linear equation $f(x)$ with slope $m$ that passes through $(a,b)$:
  \[
    f(x) = m(x-a) + b
  \]%
}

\NewFactoid{law of sines}{%
  \begin{spreadlines}{1ex}
    \begin{alignat*}{2}
      &\frac{\sin(A)}{a} = \frac{\sin(B)}{b} = \frac{\sin(C)}{c}&
    \end{alignat*}
  \end{spreadlines}
}
\NewFactoid{law of sine}{\Factoid{law of sines}}
\NewFactoid{sine law}{\Factoid{law of sines}}

\NewFactoid{law of cosines}{%
  \begin{spreadlines}{1ex}
    \begin{alignat*}{3}
      &a^2 = b^2 + c^2 - 2bc \cos(A)\\
      &b^2 = c^2 + a^2 - 2ca \cos(B)\\
      &c^2 = a^2 + b^2 - 2ab \cos(C)\\
    \end{alignat*}
  \end{spreadlines}
}
\NewFactoid{law of cosine}{\Factoid{law of cosines}}
\NewFactoid{cosine law}{\Factoid{law of cosines}}

% American High school Algebra 2 and Trigonometry

\NewFactoidBundle{transformation rules}{%
  \NewPreamble{%
    \definecolor{o}{HTML}{ff7e00}%
    \begin{spreadlines}{1ex}%
      \begin{alignat*}{5}%
        &\textbf{Notation} \quad && \textbf{Transformation Type} && \textbf{Coordinate Change} \\
  }
  \NewInteramble{\\}

  \NewEntry{vert trans}{
    & f(x) {\color o {} +d} \quad && \textrm{Vertical translation up } {\color o {} d} \textrm{ units} \quad&& (x,y) \mapsto (x, y {\color o {} +d}) \\
    & f(x) {\color o {} -d} \quad && \textrm{Vertical translation down } {\color o {} d} \textrm{ units} \quad&& (x,y) \mapsto (x, y {\color o {} -d})
  }
  \NewEntry{horz trans}{
    & f(x {\color o {} +c}) \quad && \textrm{Horizontal translation left } {\color o {} c} \textrm{ units} \quad&& (x,y) \mapsto (x {\color o {} - c }, y) \\
    & f(x {\color o {} -c}) \quad && \textrm{Horizontal translation right } {\color o {} c} \textrm{ units} \quad&& (x,y) \mapsto (x {\color o {} + c }, y)
  }
  \NewEntry{refl}{
    &  {\color o -}f(x) \quad && \textrm{Reflection over } {\color o {} x-} {\color o {} \textrm{axis}} \quad&& (x,y) \mapsto (x, {\color o {} -}y) \\
    & f({\color o -}x) \quad && \textrm{Reflection over } {\color o {} y-} {\color o {} \textrm{axis}} \quad&& (x,y) \mapsto ({\color o {} -}x, y)
  }
  \NewEntry{vert scale}{
    & {\color o a}f(x) \quad && \textrm{Vertical } {\color o {} \textrm{stretch }} \textrm{for }  {\color o {} |a| > 1} \quad&& (x,y) \mapsto (x, {\color o {} a}y) \\
    & {\color o a}f(x) \quad && \textrm{Vertical } {\color o {} \textrm{compression }} \textrm{for }  {\color o {} |a| < 1} \quad&& (x,y) \mapsto (x, {\color o {} a}y)
  }
  \NewEntry{horz scale}{
    & f({\color o b} x) \quad && \textrm{Horizontal } {\color o {} \textrm{compression }} \textrm{for }  {\color o {} |b| > 1} \quad&& (x,y) \mapsto \left(\frac{x}{{\color o {} b}}, y\right) \\
    & f({\color o b} x) \quad && \textrm{Horizontal } {\color o {} \textrm{stretch }} \textrm{for }  {\color o {} |b| < 1} \quad&& (x,y) \mapsto \left(\frac{x}{{\color o {} b}}, y\right)
  }

  \NewPostamble{%
      \end{alignat*}%
    \end{spreadlines}%
  }
}

\NewFactoidBundle{log rules}{%
  \NewPreamble{%
    \begin{spreadlines}{1ex}
      \begin{alignat*}{3}
        &\textbf{Log Rule Name} \quad && \textbf{Property} \\
  }
  \NewInteramble{\\}
  \NewEntry{log prod}{&\textrm{Product Rule} \quad && \log(x\cdot y) = \log(x) + \log(y)}
  \NewEntry{log quotient}{&\textrm{Quotient Rule} \quad && \log(\frac{x}{y}) = \log(x) - \log(y)}
  \NewEntry{log power}{&\textrm{Power Rule} \quad && \log(x^y) = y \log(x)}
  \NewEntry{log base change}{&\textrm{Base Change} \quad && \log_{b}(x) = \frac{\log_c(x)}{\log_c(b)}}
  \NewPostamble{%
      \end{alignat*}%
    \end{spreadlines}%
  }
}

\NewFactoid{sohcahtoa}{%
  \textbf{Definitions of sin/cos/tan}

  \begin{minipage}[b]{.4\linewidth}
    \begin{align*}
      \sin\th & = \frac{\text{Opposite}}{\text{Hypotenuse}} \\
      \cos\th & = \frac{\text{Adjacent}}{\text{Hypotenuse}} \\
      \tan\th & = \frac{\text{Opposite}}{\text{Adjacent}}
    \end{align*}
  \end{minipage}
  \begin{tikzpicture}
    \path coordinate (A) at (0, 0)
          coordinate (B) at (0, 3)
          coordinate (C) at (6.3, 0);
    \draw [very thick] (A) -- node [above, sloped] {Opposite} (B)
                           -- node [above, sloped] {Hypotenuse} (C)
                           -- node [below, sloped] {Adjacent} cycle;
    \path pic [draw, thick, angle radius=.5cm] {right angle=C--A--B}
          pic [draw, thick, angle radius=1.8cm, angle eccentricity=1.3, pic text=$\theta$] {angle=B--C--A};
  \end{tikzpicture}%
}

\NewFactoid{geom trig def}{%
  \def\angle{52}

  \pgfmathsetmacro{\r}{1}
  \pgfmathsetmacro{\s}{sin(\angle)}
  \pgfmathsetmacro{\c}{cos(\angle)}
  %colors
  \definecolor{r}{HTML}{ff3030}
  \definecolor{b}{HTML}{00bfff}
  \definecolor{o}{HTML}{ff7e00}
  \definecolor{g}{HTML}{50C878}

  \begin{tikzpicture}[scale=5,very thick]

    % grey axis
    \draw[gray!30] (0, 0) -- (0, 1/\s+.1);
    \draw[gray!30] (0, 0) -- (1/\c+.1, 0);

    % arc of the angle
    \draw (1/5,0) node[sloped,anchor=south east] {$\th$} arc (0:\angle:1/5);

    % radius 1, cos and sin
    \draw (0, 0) --node [sloped, above]{1} (\angle:1);
    \draw (0, \s) -- node [below]{$\cos(\th)$} (\c,\s);
    \draw (\c, \s)-- node [right]{$\sin(\th)$}(\c,0);

    % quarter circle:
    \draw (1,0) arc(0:90:1);

    % big triangle: sec(x), tan(x), csc(x), cot(x)
    \draw [r] (0, 0) -- node [below] {$\sec(\th)$} (1/\c,0);
    \draw [b] (1/\c, 0) -- node [sloped,above] {$\tan(\th)$} (\c,\s);
    \draw [o] (0, 0) -- node [left=1mm] {$\csc(\th)$} (0,1/\s);
    \draw [g] (0, 1/\s) -- node [sloped,above] {$\cot(\th)$} (\c,\s);
  \end{tikzpicture}}

\NewFactoidBundle{double angle}{%
  \NewPreamble{%
    \begin{align*}%
  }
  \NewInteramble{\\}
  \NewEntry{cos}{
    \cos (2\th) &= \cos^2(\th) - \sin^2(\th) \\
      &= 2\cos^2(\th) - 1 \\
      &= 1 - 2\sin^2(\th)
  }
  \NewEntry{sin}{\sin(2\th) &= 2\sin(\th)\cos(\th)}
  \NewEntry{tan}{\tan(2\th) &= \frac{2\tan(\th)}{1-\tan^2(\th)}}
  \NewPostamble{%
    \end{align*}%
  }
}

\NewFactoidBundle{half angle}{%
  \NewPreamble{%
    \begin{align*}%
  }
  \NewInteramble{\\}
  \NewEntry{sin}{\sin(\tfrac{\th}{2}) &= \pm\sqrt{\tfrac{1-\cos(\th)}{2}}}
  \NewEntry{cos}{\cos(\tfrac{\th}{2}) &= \pm\sqrt{\tfrac{1+\cos(\th)}{2}}}
  \NewEntry{tan}{\tan(\tfrac{\th}{2}) &= \pm\sqrt{\tfrac{1-\cos(\th)}{1+\cos(\th)}}}
  \NewPostamble{%
    \end{align*}%
  }
}

\NewFactoidBundle{sum diff trig}{%
  \NewPreamble{%
    \begin{spreadlines}{1.5ex}%
      \begin{alignat*}{2}%
  }
  \NewInteramble{\\}
  \NewEntry{sin}{\sin (\th \pm \vp) &= \sin(\th)\cos(\vp) \pm \cos(\th)\sin(\vp)}
  \NewEntry{cos}{\cos (\th \pm \vp) &= \cos(\th)\cos(\vp) \mp \sin(\th)\sin(\vp)}
  \NewEntry{tan}{\tan (\th \pm \vp) &= \frac{\tan(\th) \pm \tan(\vp)}{1 \mp \tan(\th)\tan(\vp)}}
  \NewPostamble{%
      \end{alignat*}%
    \end{spreadlines}%
  }
}

\NewFactoid{recip trig}{%
  \begin{spreadlines}{1.5ex}
    \begin{alignat*}{2}
      \csc(x) & = \tfrac 1 {\sin(x)}, \quad & \tan(x) & = \tfrac {\sin(x)} {\cos(x)} \\
      \sec(x) & = \tfrac 1 {\cos(x)}, \quad & \cot(x) & = \tfrac {\cos(x)} {\sin(x)}
    \end{alignat*}
  \end{spreadlines}
}

% trig reflect identities
\NewFactoidBundle{reflect trig}{%
  \NewPreamble{%
    \begin{spreadlines}{1.5ex}
      \begin{alignat*}{3}%
  }
  \NewInteramble{\\}
  \NewEntry{sin}{\sin(-x) &= -\sin(x), \quad & \sin(\tfrac\pi2 - x) &= \cos(x), \quad & \sin(\pi - x) &= \hphantom-\sin(x)}
  \NewEntry{cos}{\cos(-x) &= \hphantom-\cos(x), \quad & \cos(\tfrac\pi2 - x) &= \sin(x), \quad & \cos(\pi - x) &= -\cos(x)}
  \NewEntry{tan}{\tan(-x) &= -\tan(x), \quad & \tan(\tfrac\pi2 - x) &= \tfrac1{\tan(x)}, \quad & \tan(\pi - x) &= -\tan(x)}
  \NewPostamble{%
      \end{alignat*}%
    \end{spreadlines}%
  }
}

% trig shift identities
\NewFactoidBundle{shift trig}{%
  \NewPreamble{%
    \begin{spreadlines}{1.5ex}
      \begin{alignat*}{2}%
  }
  \NewInteramble{\\}
  \NewEntry{sin}{\sin\left(\frac\pi2 + x\right) &=  \cos(x), \quad & \sin\left(\pi + x\right) &= -\sin(x)}
  \NewEntry{cos}{\cos\left(\frac\pi2 + x\right) &= -\sin(x), \quad & \cos\left(\pi + x\right) &= -\cos(x)}
  \NewEntry{tan}{\tan\left(\frac\pi2 + x\right) &= -\frac{1}{\tan(x)}, \quad & \tan\left(\pi + x\right) &=  \tan(x)}
  \NewPostamble{%
      \end{alignat*}%
    \end{spreadlines}%
  }
}

% all trig identities (shift and reflect) minimize in one table
\NewFactoidBundle{reflect shift trig}{
  \NewPreamble{%
    \tabskip=0pt
    \setbox2=\hbox{\vrule height3.5ex depth3ex width0pt}
    \halign\bgroup
      \unhcopy2\strut#&\vrule#\tabskip=1em&\hfil$#$\hfil&\vrule#&\hfil$#$\hfil&\vrule#&\hfil$#$\hfil&\vrule#&\hfil$#$\hfil&\vrule#&\hfil$#$\hfil&#\vrule\tabskip=0pt\cr
      \noalign{\hrule}%
      &&\th&&\frac{\pi}{2} - x&&\frac{\pi}{2} + x&&\pi - x&&\pi +x&\cr
      \noalign{\hrule}%
  }
  \NewInteramble{\noalign{\hrule}}
  \NewEntry{sin}{&&\sin(\th)&&\cos(x)&&\cos(x)&&\sin(x)&&-\sin(x)&\cr}
  \NewEntry{cos}{&&\cos(\th)&&\sin(x)&&-\sin(x)&&-\cos(x)&&-\cos(x)&\cr}
  \NewEntry{tan}{&&\tan(\th)&&\frac{1}{\tan(x)}&&\frac{-1}{\tan(x)}&&-\tan(x)&&\tan(x)&\cr}
  \NewPostamble{%
      \noalign{\hrule}%
    \egroup
  }
}

% sum-to-product formulas
\NewFactoidBundle{sum2prod}{%
  \NewPreamble{%
    \begin{spreadlines}{1.3ex}
      \begin{alignat*}{3}%
  }
  \NewInteramble{\\}
  \NewEntry{cos + cos}{&\cos(x) + \cos(y)\ &=\ &\, 2\cos(\tfrac{x + y}2)\cos(\tfrac{x - y}2)}
  \NewEntry{cos - cos}{&\cos(x) - \cos(y)\ &=\ &\, 2\sin(\tfrac{x + y}2)\sin(\tfrac{y - x}2)}
  \NewEntry{sin + sin}{&\sin(x) + \sin(y)\ &=\ &\, 2\sin(\tfrac{x + y}2)\cos(\tfrac{x - y}2)}
  \NewEntry{sin - sin}{&\sin(x) - \sin(y)\ &=\ &\, 2\cos(\tfrac{x + y}2)\sin(\tfrac{x - y}2)}
  \NewPostamble{%
      \end{alignat*}%
    \end{spreadlines}%
  }
}%

% product-to-sum formulas
\NewFactoidBundle{prod2sum}{%
  \NewPreamble{%
    \begin{spreadlines}{1ex}
      \begin{alignat*}{3}%
  }
  \NewInteramble{\\}
  \NewEntry{sinsin}{&2\sin(x)\sin(y)\ &=\ & \cos(x-y)-\cos(x + y)}
  \NewEntry{sincos}{&2\sin(x)\cos(y)\ &=\ & \sin(x + y) + \sin(x - y)}
  \NewEntry{coscos}{&2\cos(x)\cos(y)\ &=\ & \cos(x + y) + \cos(x - y)}
  \NewPostamble{%
      \end{alignat*}%
    \end{spreadlines}%
  }
}

% long list of trig identities
\NewFactoid{rocket trig}{
  \text{Defining relations:} \hspace{3cm} $\approx \mathcal{O}\omega \mathcal{O}\approx$
  \begin{flalign*}
    &\quad \csc(x) = \tfrac1{\sin(x)}\quad\tan(x) = \tfrac{\sin(x)}{\cos(x)} &\\
    &\quad \sec(x) = \tfrac1{\cos(x)}\quad\cot(x) = \tfrac1{\tan(x)} = \tfrac{\cos(x)}{\sin(x)}&
  \end{flalign*}
  \text{Pythagoras:}
  \begin{flalign*}
    &\quad \sin^2(x) + \cos^2(x) = 1 &\\
    &\quad 1 + \cot^2(x) = \csc^2(x) &\\
    &\quad \tan^2(x) + 1 = \sec^2(x)&
  \end{flalign*}
  \text{Cofunction, Negative angle, and Supplement:}
  \begin{flalign*}
    &\quad \sin(x) = \cos(\tfrac\pi2-x)\quad\sin(-x) = -\sin(x) &\\
    &\quad \cos(x) = \sin(\tfrac\pi2-x)\quad\cos(-x) = \cos(x) &\\
    &\quad \tan(x) = \cot(\tfrac\pi2-x)\quad\tan(-x) = -\tan(x) &\\
    &\quad \sin(\pi-x) = \sin(x) &\\
    &\quad \cos(\pi-x) = -\cos(x) &\\
    &\quad \tan(\pi-x) = -\tan(x) &
  \end{flalign*}
  \text{Periodicity: for all} $n\in\Z$
  \begin{flalign*}
    &\quad \sin(x + 2\pi n) = \sin(x) &\\
    &\quad \cos(x + 2\pi n) = \cos(x) &\\
    &\quad \tan(x + \pi n) = \tan(x) &
  \end{flalign*}
  \text{Addition:}
  \begin{flalign*}
    &\quad \sin(x\pm y) = \sin(x)\cos(y)\pm\cos(x)\sin(y) &\\
    &\quad \cos(x\pm y) = \cos(x)\cos(y)\mp\sin(x)\sin(y) &\\
    &\quad \tan(x\pm y) = \tfrac{\tan(x)\pm\tan(y)}{1\mp\tan(x)\tan(y)} &
  \end{flalign*}
  \text{Double angle:}
  \begin{flalign*}
    &\quad \sin(2x) = 2\sin(x)\cos(x) &\\
    &\quad \cos(2x) = \cos^2(x)-\sin^2(x) \\
    &\quad \cos(2x) = 2\cos^2(x)-1 = 1-2\sin^2(x) &\\
    &\quad \tan(2x) = \tfrac{2\tan(x)}{1-\tan^2(x)} &
  \end{flalign*}
  \text{Sum--to--product and Product--to--sum:}
  \begin{flalign*}
    &\quad \cos(x) + \cos(y) = 2\cos(\tfrac{x + y}2)\cos(\tfrac{x-y}2) &\\
    &\quad \cos(x)-\cos(y) = -2\sin(\tfrac{x + y}2)\sin(\tfrac{x-y}2) &\\
    &\quad \sin(x)\pm\sin(y) = 2\sin(\tfrac{x\pm y}2)\cos(\tfrac{x\mp y}2) &\\
    &\quad 2\sin(x)\sin(y) = \cos(x-y)-\cos(x + y) &\\
    &\quad 2\sin(x)\cos(y) = \sin(x + y) + \sin(x - y) &\\
    &\quad 2\cos(x)\cos(y) = \cos(x + y) + \cos(x - y) &
  \end{flalign*}
}

\NewFactoid{unit circle}{%
  \begin{tikzpicture}[scale=4.5, font=\small]
    \definecolor{r}{HTML}{ff3030}
    \definecolor{b}{HTML}{00bfff}
    \definecolor{o}{HTML}{ff7e00}
    \def\angles{
      0/2\pi/1/0,
      30/\frac\pi6/\frac{\sqrt3}2/\frac12,
      45/\frac\pi4/\frac{\sqrt2}2/\frac{\sqrt2}2,
      60/\frac\pi3/\frac12/\frac{\sqrt3}2,
      90/\frac\pi2/0/1,
      120/\frac{2\pi}3/\shortminus\frac12/\frac{\sqrt3}2,
      135/\frac{3\pi}4/\shortminus\frac{\sqrt2}2/\frac{\sqrt2}2,
      150/\frac{5\pi}6/\shortminus\frac{\sqrt3}2/\frac12,
      180/\pi/\shortminus1/0,
      210/\frac{7\pi}6/\shortminus\frac{\sqrt3}2/\shortminus\frac12,
      225/\frac{5\pi}4/\shortminus\frac{\sqrt2}2/\shortminus\frac{\sqrt2}2,
      240/\frac{4\pi}3/\shortminus\frac12/\shortminus\frac{\sqrt3}2,
      270/\frac{3\pi}2/0/\shortminus1,
      300/\frac{5\pi}3/\frac12/\shortminus\frac{\sqrt3}2,
      315/\frac{7\pi}4/\frac{\sqrt2}2/\shortminus\frac{\sqrt2}2,
      330/\frac{11\pi}6/\frac{\sqrt3}2/\shortminus\frac12
    }
    \begin{scope}[every node/.style={inner sep=1pt, outer sep=0pt}]
      \foreach \a/\at/\x/\y in \angles {
        \begin{pgfinterruptboundingbox}
          \node (x) at (\a : 1.15) [anchor=\a-180] {\phantom{$\textstyle\left({\color b \x}, {\color o \y}\right)$}};
          \clip [rounded corners] (x.south west) rectangle (x.north east) (-1.6, -1.6) -- (1.6, -1.6) -- (1.6, 1.6) -- (-1.6, 1.6) -- cycle;
          \node (x) at (\a : 0.85) [anchor=\a] {\phantom{$\textstyle\at$}};
          \clip [rounded corners] (x.south west) rectangle (x.north east) (-1.6, -1.6) -- (1.6, -1.6) -- (1.6, 1.6) -- (-1.6, 1.6) -- cycle;
          \node (x) at (\a : 0.65) [anchor=\a, font=\footnotesize] {\phantom{$\textstyle\a^\circ$}};
          \clip [rounded corners] (x.south west) rectangle (x.north east) (-1.6, -1.6) -- (1.6, -1.6) -- (1.6, 1.6) -- (-1.6, 1.6) -- cycle;
          \clip (\a : 1) circle [radius=.5pt] (-1.6, -1.6) -- (-1.6, 1.6) -- (1.6, 1.6) -- (1.6, -1.6) -- cycle;
        \end{pgfinterruptboundingbox}
      }

      \draw [r, thick] (-1.5, 0) edge [-{Classical TikZ Rightarrow[length=5pt, width=6pt]}] (1.5, 0) node at (1.5, 0) [right=5pt] {$\textstyle\color b x$}
      (0, -1.5) edge [-{Classical TikZ Rightarrow[length=5pt, width=6pt]}] (0, 1.5) node at (0, 1.5) [above=5pt] {$\textstyle\color o y$};
      \draw [very thick] (0, 0) circle [radius=1];

      \foreach \a/\at/\x/\y in \angles { \draw [opacity=.4] (0, 0) -- (\a : 1); }
    \end{scope}

    \scoped [every node/.style={inner sep=1pt, outer sep=0pt}] {
      \foreach \a/\at/\x/\y in \angles {
        \node at (\a : 1.15) [anchor=\a-180, rounded corners] {$\textstyle\left({\color b \x}, {\color o \y}\right)$};
        \node at (\a : 0.85) [anchor=\a, rounded corners] {$\textstyle\at$};
        \node at (\a : 0.65) [anchor=\a, rounded corners, font=\footnotesize] {$\textstyle\a^\circ$};
        \draw [thick] (\a : 1) circle [radius=.5pt];
      }
    }

    \node at (1, 1.5) [thick, draw=r, rounded corners=6pt] {$\textstyle\left({\color b \cos(\theta)}, {\color o \sin(\theta)}\right)$};
    % \node at (0, 1.8) [font={\Huge\sffamily}] {Unit Circle};
  \end{tikzpicture}%
}

\NewFactoid{demoivre}{$(e^{ix})^n = (\cos(x) + i\sin(x))^n = \cos(nx) + i\sin(nx)$}

% First year university/college Calculus
\NewFactoidBundle{limit rules}{%
  \NewPreamble{%
    Suppose $\lim_{x \to a} f(x) = L$,\ $\lim_{x \to a} g(x) = M$, and $n>0$
    \begin{spreadlines}{1ex}
      \begin{alignat*}{3}
        &\textbf{Rule Name} \quad && \textbf{Property} \\
  }
  \NewInteramble{\\}
  \NewEntry{limit sum}{&\textrm{Sum/Difference} \quad && \lim_{x \to a}  f(x) \pm g(x) = L \pm M}
  \NewEntry{limit multiple}{&\textrm{Constant Multiple} \quad && \lim_{x \to a} c f(x) = cL}
  \NewEntry{limit prod}{&\textrm{Product} \quad &&  \lim_{x \to a} f(x) g(x) = L M}
  \NewEntry{limit quotient}{&\textrm{Quotient} \quad &&  \lim_{x \to a} \frac{f(x)}{g(x)} = \frac{L}{M}}
  \NewEntry{limit power}{&\textrm{Power} \quad &&  \lim_{x \to a} \left(f(x)\right)^n= L^n}
  \NewEntry{limit root}{&\textrm{Root} \quad && \lim_{x \to a} \sqrt[n]{f(x)} = \sqrt[n]{L}, \ L \ge 0}
  \NewPostamble{%
      \end{alignat*}%
    \end{spreadlines}%
  }
}
\NewFactoid{calculate limit}{%
\begin{tikzpicture}
  \node (header) [font=\Huge] {Calculating $\displaystyle\lim_{x \to a} f(x)$};

  \node (A) [below=3ex of header, text width=16em, align=center, font=\sffamily] {\textbf{A. Direct substitution} \\ Try to evaluate the function directly};
  \node (fa) [below=1ex of A, font=\Huge] {$f(a)$};

  \node (B) [below left=3ex and 4em of fa, text width=12em, align=center, font=\sffamily] {{\LARGE ${f(a) = \smash{\tfrac b0}}$} \\[.7ex] when $\boldsymbol b$ is not zero \\[1ex] \textbf{B. Asymptote} \\ (probably)};
  \node (C) [below=3ex of fa, text width=12em, align=center, font=\sffamily] {{\LARGE ${f(a) = b}$} \\[.7ex] when $\boldsymbol b$ is a real number \\[1ex] \textbf{C. Limit found} \\ (probably)};
  \node (D) [below right=3ex and 4em of fa, text width=12em, align=center, font=\sffamily] {{\LARGE ${f(a) = \smash{\tfrac 00}}$} \\[.7ex] \hphantom{when $\boldsymbol b$} \\[1ex] \textbf{D. Indeterminate form}};
  \node (D') [below right=3ex and 4em of fa, text width=12em, align=center, font=\sffamily] {\phantom{\LARGE ${f(a) = \smash{\tfrac 00}}$} \\[.7ex] \hphantom{when $\boldsymbol b$} \\[1ex] \phantom{\textbf{D. Indeterminate form}} \\ \phantom{(probably)}};

  \node (try) [below=3ex of C, font=\sffamily] {Try rewriting the limit as an equivalent form.};

  \node (E) [below=10ex of B, font=\sffamily] {\textbf{E. Factoring}};
  \node (F) [below=10ex of C, font=\sffamily] {\textbf{F. Conjugates}};
  \node (G) [below=10ex of D', font=\sffamily] {\textbf{G. Trig identities}};

  \node (try-new) [below=3.5ex of F, font=\sffamily] {Try evaluating the limit in its new form.};

  \node (H) [below=3ex of try-new, font=\sffamily] {\textbf{H. Approximation}};
  \node (H') [below=.1ex of H, text width=20em, align=center, font=\sffamily] {When all else fails, graphs and tables \\ can help approximate limits.};

  \draw [ultra thick, ->] (fa.west) -| (B.north);
  \draw [ultra thick, ->] (fa.south) -- (C.north);
  \draw [ultra thick, ->] (fa.east) -| (D.north);
  \draw [ultra thick, ->] (D.south) |- (C.south) -| (try.north);
  \draw [ultra thick, ->] (try.west) -| (E.north);
  \draw [ultra thick, ->] (try.south) -- (F.north);
  \draw [ultra thick, ->] ([yshift=-.3ex] try.east) -| (G.north);
  \draw [ultra thick] (E.south) -- (G.south);
  \draw [ultra thick, ->] ([yshift=-.5ex] F.south) -- (try-new.north);
  \draw [ultra thick, ->] (try-new.west) -- ([xshift=-18em] try-new.center) |- (A.west);
  \draw [ultra thick, ->] ([yshift=.3ex] try.east) -- ([yshift=.1ex, xshift=18em] try.center) |- (H.east);
\end{tikzpicture}
}
\NewFactoid{calc limit}{\Factoid{calculate limit}}

\NewFactoidBundle{diff rules}{%
  \NewPreamble{%
    \begin{tabular}{lcc}
      \textbf{Rule Name} & \textbf{Function} & \textbf{Derivative} \\ \hline
  }
  \NewInteramble{\\}
  \NewEntry{diff multiple}{\rule{0pt}{4ex}Constant multiple & $ cf(x)$ & $cf'(x) $}
  \NewEntry{power rule}{\rule{0pt}{4ex}Power Rule & $ x^n$ & $n x^{n-1} $}
  \NewEntry{diff sum}{\rule{0pt}{4ex}Sum Rule & $ f(x) + g(x)$ & $ f'(x) + g'(x) $}
  \NewEntry{product rule}{\rule{0pt}{4ex}Product Rule & $ f(x)\cdot g(x)$ & $ f'(x)\cdot g(x) + f(x) \cdot g'(x) $}
  \NewEntry{quotient rule}{\rule{0pt}{4ex}Quotient Rule & $ \frac{f(x)}{g(x)}$ & $\frac{f'(x)\cdot g(x) - f(x)\cdot g'(x)}{[g(x)]^2} $}
  \NewEntry{chain rule}{%
    \rule{0pt}{4ex}Chain Rule Lagrange & $f(g(x))$ & $ f'(g(x)) \cdot g'(x) $ \\
    \rule{0pt}{4ex}Chain Rule Leibniz & $z\hspace{-.2em} =\hspace{-.2em} f(y), y \hspace{-.2em}=\hspace{-.2em} g(x)$ & $\frac{dz}{dx} = \frac{dz}{dy} \cdot \frac{dy}{dx}$
  }
  \NewPostamble{%
    \end{tabular}%
  }
}

\NewFactoidBundle{diff std}{%
    \NewPreamble{%
      \begin{tabular}{lcc}
        \textbf{Function} & \textbf{Derivative} \\ \hline
    }
    \NewInteramble{\\}
    \NewEntry{diff constant}{$ c $ & $ 0 $}
    \NewEntry{diff poly}{$ x^n $ & $ n x^{n-1} $}
    \NewEntry{diff exp}{$ e^x $ & $ e^x $}
    \NewEntry{diff ln}{$ \ln(x) $ & $ \frac{1}{x} $}
    \NewPostamble{%
      \end{tabular}%
    }
}

\NewFactoidBundle{diff trig}{%
  \NewPreamble{%
    \begin{tabular}{lcc}
      \textbf{Function} & \textbf{Derivative} \\ \hline
  }
  \NewInteramble{\\}
  \NewEntry{diff sin}{$ \sin(x) $ & $ \cos(x) $}
  \NewEntry{diff cos}{$ \cos(x) $ & $ -\sin(x) $}
  \NewEntry{diff tan}{$ \tan(x) $ & $ \sec^2(x) $}
  \NewEntry{diff csc}{$ \csc(x) $ & $ -\csc(x)\cot(x) $}
  \NewEntry{diff sec}{$ \sec(x) $ & $ \sec(x)\tan(x) $}
  \NewEntry{diff cot}{$ \cot(x) $ & $ -\csc^2(x) $}
  \NewPostamble{%
    \end{tabular}%
  }
}

\NewFactoidBundle{diff inv trig}{%
  \NewPreamble{%
    \begin{tabular}{lcc}
      \textbf{Function} & \textbf{Derivative} \\ \hline
  }
  \NewInteramble{\\}
  \NewEntry{diff arcsin}{\rule{0pt}{4ex}$ \arcsin(x) $ & $ \frac{1}{\sqrt{1-x^2}} $}
  \NewEntry{diff arccos}{\rule{0pt}{4ex}$ \arccos(x) $ & $ -\frac{1}{\sqrt{1-x^2}} $}
  \NewEntry{diff arctan}{\rule{0pt}{4ex}$ \arctan(x) $ & $ \frac{1}{1+x^2} $}
  \NewEntry{diff arccot}{\rule{0pt}{4ex}$ \arccot(x) $ & $ -\frac{1}{1+x^2} $}
  \NewEntry{diff arcsec}{\rule{0pt}{4ex}$ \arcsec(x) $ & $ \frac{1}{|x|\sqrt{x^2-1}} $}
  \NewEntry{diff arccsc}{\rule{0pt}{4ex}$ \arccsc(x) $ & $ -\frac{1}{|x|\sqrt{x^2-1}} $}
  \NewPostamble{%
    \end{tabular}%
  }
}

\NewFactoidBundle{diff trigh}{%
    \NewPreamble{%
      \begin{tabular}{lcc}
        \textbf{Function} & \textbf{Derivative} \\ \hline
    }
    \NewInteramble{\\}
    \NewEntry{diff sinh}{\rule{0pt}{4ex}$ \sinh(x) $ & $ \cosh(x) $}
    \NewEntry{diff cosh}{\rule{0pt}{4ex}$ \cosh(x) $ & $ \sinh(x) $}
    \NewEntry{diff tanh}{\rule{0pt}{4ex}$ \tanh(x) $ & $ \sech^2(x) $}
    \NewEntry{diff coth}{\rule{0pt}{4ex}$ \coth(x) $ & $ -\csch^2(x) $}
    \NewEntry{diff sech}{\rule{0pt}{4ex}$ \sech(x) $ & $ -\sech(x)\tanh(x) $}
    \NewEntry{diff csch}{\rule{0pt}{4ex}$ \csch(x) $ & $ -\csch(x)\coth(x) $}
    \NewPostamble{%
      \end{tabular}%
    }
}

\NewFactoidBundle{diff inv trigh}{%
  \NewPreamble{%
    \begin{tabular}{lcc}
      \textbf{Function} & \textbf{Derivative} & \textbf{Restriction}\\ \hline
  }
  \NewInteramble{\\}
  \NewEntry{diff arsinh}{\rule{0pt}{4ex}$ \operatorname{arsinh}(x) $ & $ \frac{1}{\sqrt{x^2+1}} $ & $ \textrm{None} $}
  \NewEntry{diff arcosh}{\rule{0pt}{4ex}$ \operatorname{arcosh}(x) $ & $ \frac{1}{\sqrt{x^2-1}} $ & $ x>1 $}
  \NewEntry{diff artanh}{\rule{0pt}{4ex}$ \operatorname{artanh}(x) $ & $ \frac{1}{1-x^2} $ & $ |x|<1 $}
  \NewEntry{diff arcoth}{\rule{0pt}{4ex}$ \operatorname{arcoth}(x) $ & $ \frac{1}{1-x^2} $ & $ |x|>1 $}
  \NewEntry{diff arsech}{\rule{0pt}{4ex}$ \operatorname{arsech}(x) $ & $ -\frac{1}{x\sqrt{1-x^2}} $ & $ 0<x<1 $}
  \NewEntry{diff arcsch}{\rule{0pt}{4ex}$ \operatorname{arcsch}(x) $ & $ -\frac{1}{\abs{x}\sqrt{1+x^2}} $ & $ x \ne 0 $}
  \NewPostamble{%
    \end{tabular}%
  }
}

\NewFactoidBundle{int rules}{%
  \NewPreamble{%
    Suppose $F'(x) = f(x)$ and $G'(x) = g(x)$ and $C$ an arbitrary constant.
    \begin{spreadlines}{1ex}
      \begin{alignat*}{3}
        &\textbf{Rule Name} \quad && \textbf{Property} \\
  }
  \NewInteramble{\\}
  \NewEntry{int multiple}{&\textrm{Constant multiple} \quad && \int \alpha f(x)\, dx = \alpha F(x) + C}
  \NewEntry{int sum}{&\textrm{Sum Rule} \quad && \int f(x) + g(x)\, dx =  F(x) + G(x) + C}
  \NewEntry{ibp}{
    &\textrm{Int. by Parts (1)} \quad && \int_a^b f(x) g'(x)\, dx =  f(b)g(b) - f(a) g(a) + \int_a^b f'(x) g(x)\, dx \\
    &\textrm{Int. by Parts (2)} \quad && \int u dv = uv - \int vdu
  }
  \NewEntry{u-sub}{&\textrm{Substitution Rule} \quad && \int f(g(x)) g'(x)\, dx = \int f(u)\, du = F(u) + C = F(g(x)) + C}
  \NewPostamble{%
      \end{alignat*}%
    \end{spreadlines}%
  }
}

\NewFactoid{FTC1}{%
  Let $F(x)$ be the antiderivative of $f(x)$:
  \[
    \int_a^b f(x) \, dx = F(b) - F(a)
  \]%
}

\NewFactoid{FTC2}{%
  \[
    \frac{d}{dx}\int_{a(x)}^{b(x)}f(t)dt = f(b(x))\cdot b'(x) - f(a(x)) \cdot a'(x)
  \]%
}

\NewFactoid{integral area}{%
  The area between two curves can be described:
  \[
    \int_a^b\int_{\text{Bottom}(x)}^{\text{Top}(x)}1dydx = \int_a^b[\text{Top}(x) - \text{Bottom}(x)]dx
  \]
  Or
  \[
    \int_c^d\int_{\text{Right}(y)}^{\text{Left}(y)}1dxdy = \int_c^d[\text{Left}(x) - \text{Right}(x)]dy
  \]%
}

\makeatletter
\NewFactoidBundle{maclaurin}{%
  \NewPreamble{%
    \setbox0=\hbox{$\displaystyle\sum_{k = 0}^{k = 0}$}
    \setbox0=\hbox{\vrule height\dimexpr\ht0+.5ex\relax depth\dimexpr\dp0+.5ex\relax width0pt}
    \setbox2=\hbox{\vrule height2.5ex depth1ex width0pt}
    \def\bigmathstrut{\unhcopy0}
    \def\bigstrut{\unhcopy2}
    \def\thickrule{\noalign{\hrule height.8pt}}
    \def\thinrule{\noalign{\hrule}}
    \def\verythinrule{\noalign{\hrule height.2pt}}
    \def\tablerow#1#2#3#4#5#6#7#8#9{%
      \@tablerow{%
        \bigmathstrut&%
        $\m@th\displaystyle #1$&%
        $\m@th\displaystyle #2$&${}#3{}\m@th$&%
        $\m@th\displaystyle #4$&${}#5{}\m@th$&%
        $\m@th\displaystyle #6$&${}#7{}\m@th$&%
        $\m@th\displaystyle #8$&${}#9\dotsb\m@th$&%
      }%
    }
    \def\@tablerow#1#2{%
      #1%
      $\m@th\displaystyle #2$
    }
    \vbox\bgroup\tabskip=0pt \offinterlineskip\halign\bgroup%
      #\tabskip=1em&\hfil#\hfil&\tabskip=0pt%
        \hfil#\hfil&\hfil#\hfil&%
        \hfil#\hfil&\hfil#\hfil&%
        \hfil#\hfil&\hfil#\hfil&%
        \hfil#\hfil&\hfil#\hfil\tabskip=2em&%
        #\hfil\cr \thickrule
      \bigstrut&Function&\omit Maclaurin series\hfil\hidewidth&&&&&&&&Sigma notation\cr \thinrule
  }
  \NewInteramble{\verythinrule}
  \NewEntry{exp}{\tablerow
      {e^x}
      1 + {\frac x {1!}} + {\frac {x^2} {2!}} + {\frac {x^3} {3!}} +
      {\sum_{k = 0}^\infty \frac {x^k} {k!}}\cr}
  \NewEntry{sin}{\tablerow
      {\sin(x)}
      {\frac x {1!}} - {\frac {x^3} {3!}} + {\frac {x^5} {5!}} - {\frac {x^7} {7!}} +
      {\sum_{k = 0}^\infty (-1)^k \frac {x^{2k + 1}} {(2k + 1)!}}\cr}
  \NewEntry{cos}{\tablerow
      {\cos(x)}
      1 - {\frac {x^2} {2!}} + {\frac {x^4} {4!}} - {\frac {x^6} {6!}} +
      {\sum_{k = 0}^\infty (-1)^k \frac {x^{2k}} {(2k)!}}\cr}
  \NewEntry{geom series}{\tablerow
      {\frac 1 {1 - x}}
      1 + x + {x^2} + {x^3} +
      {\sum_{k = 0}^\infty x^k},\quad\hfill $-1 < x < 1$\cr}
  \NewEntry{log}{\tablerow
      {\ln(1 + x)}
      {\frac x 1} - {\frac {x^2} 2} + {\frac {x^3} 3} - {\frac {x^4} 4} +
      {\sum_{k = 1}^\infty (-1)^{k + 1} \frac {x^k} k},\quad\hfill $-1 < x \le 1$\cr}
  \NewPostamble{%
      \thickrule
    \egroup\egroup
  }
}
\makeatother

\makeatletter
\ExplSyntaxOn
\let\int@zero@new@N\int_zero_new:N
\let\int@compare@nNnTF\int_compare:nNnTF
\let\int@mod@nn\int_mod:nn
\let\int@incr@N\int_incr:N
\let\tl@clear@new@N\tl_clear_new:N
\let\tl@put@left@Nn\tl_put_left:Nn
\let\tl@put@right@Nn\tl_put_right:Nn
\let\tl@use@N\tl_use:N
\ExplSyntaxOff
\NewFactoidBundle{2d geom}{%
  \NewPreamble{%
    \int@zero@new@N\l@plane@geom@int
    \tl@clear@new@N\l@plane@geom@tl
  }
  \NewInteramble{%
    \int@compare@nNnTF{\int@mod@nn{\l@plane@geom@int}{3}}={0}
      {\tl@put@right@Nn\l@plane@geom@tl{\\\hline}}
      {\tl@put@right@Nn\l@plane@geom@tl{&}}%
  }
  \NewEntry{circle}{
    \int@incr@N\l@plane@geom@int
    \tl@put@right@Nn\l@plane@geom@tl{\vbox{\halign{%
      \hfil\strut#\hfil\cr
      \tikz [baseline={(d.base)}]{
        \draw circle (1);
        \draw [dashed] (0, -1) -- node [left] (d) {$d$} (0, 1);
        \draw [dashed] (0, 0) -- node [above] {$r$} (1, 0);
      }\cr
      $A = \pi r^2$\cr
      $C = 2\pi r$\cr
    }}}%
  }
  \NewEntry{rectangle}{
    \int@incr@N\l@plane@geom@int
    \tl@put@right@Nn\l@plane@geom@tl{\vbox{\halign{%
      \hfil\strut#\hfil\cr
      \tikz [baseline={(r.base)}] {
        \useasboundingbox (-1.2, -1.0) rectangle (1.2, 1.2);
        \draw (-1, -0.618)
          -- node [above] {$b$} (1, -0.618)
          -- node [left] (r) {$h$} (1, 0.618)
          -- (-1, 0.618)
          -- cycle;
      }\cr
      $A = bh$\cr
      $P = 2b + 2h$\cr
    }}}%
  }
  \NewEntry{parallelogram}{
    \int@incr@N\l@plane@geom@int
    \tl@put@right@Nn\l@plane@geom@tl{\vbox{\halign{%
      \hfil\strut#\hfil\cr
      \tikz [baseline={(p.base)}] {
        \useasboundingbox (-1.2, -1.0) rectangle (1.2, 1.2);
        \draw (-1, -0.88)
          -- (0.5, -0.88) node [pos=0.4, above] {$b$}
          -- (1, 0.88) node [midway] (p){}
          -- (-0.5, 0.88)
          -- cycle;
        \draw[dashed] (0.2,-0.88) -- (0.2,0.88) node [pos=0.6, right]{$h$}
      }\cr
      $A = bh$\cr
      \cr
    }}}%
  }
  \NewEntry{sector}{
    \int@incr@N\l@plane@geom@int
    \tl@put@right@Nn\l@plane@geom@tl{\vbox{\halign{%
      \hfil\strut#\hfil\cr
      \tikz [baseline={(sector.base)}] {
        \useasboundingbox (-1.5, -1.2) rectangle (1.5, 1.0);
        \draw (0,-1.2) node(sector){};
        \draw (0,-1) -- (1.414, -1+1.414) node [midway, above] {$r$}
          arc (45:135:2)
          -- cycle;
        \draw (0+1.414*0.1, -1+1.414*0.1) arc (45:135:0.2) node[midway, above] {$\theta$};
      }\cr
      $\vcenter{\halign{%
        \hfil\strut$#$\hfil\cr
        A = \frac12r^2\theta\cr
        P = 2r + r\theta\cr
      }}$\cr
    }}}%
  }
  \NewEntry{triangle}{
    \int@incr@N\l@plane@geom@int
    \tl@put@right@Nn\l@plane@geom@tl{\vbox{\halign{%
      \hfil\strut#\hfil\cr
      \tikz [baseline={(t.base)}] {
        \useasboundingbox (-1.0, -1.8) rectangle (1.0, 1.0);
        \draw (-1,-1) -- (1,-1) node [midway, below]{$b$} -- (0,1) -- cycle;
        \draw[dashed] (0,-1) -- (0,1) node [pos=0.4, left]{$h$};
        \draw (0,0) node(t){};
      }\cr
      $A = \frac12bh$\cr
    }}}%
  }
  \NewEntry{trapezoid}{
    \int@incr@N\l@plane@geom@int
    \tl@put@right@Nn\l@plane@geom@tl{\vbox{\halign{%
      \hfil\strut#\hfil\cr
      \tikz [baseline={(trap.base)}] {
        \useasboundingbox (-1.2, -1.5) rectangle (1.2, 1.5);
        \draw (0,0) node(trap){};
        \draw (-1,-1)
          -- (1,-1) node [midway, below]{$b$}
          -- (0.5,1)
          -- (-0.5,1) node [midway, above]{$a$}
          -- cycle;
        \draw[dashed] (0,-1) -- (0,1) node [midway, right]{$h$};
      }\cr
      $A = h\left(\frac{a+b}2\right)$\cr
    }}}%
  }
  \NewEntry{ellipse}{
    \int@incr@N\l@plane@geom@int
    \tl@put@right@Nn\l@plane@geom@tl{\vbox{\halign{%
      \hfil\vphantom{$\frac\strut\strut$}#\hfil\cr
      \tikz [baseline={(ellipse.base)}] {
        %\useasboundingbox (-1, -1.2) rectangle (2.2, 1.2);
        \draw (0,0) node(ellipse){};
        \draw (0,0) ellipse (1.5 and 1);
        \draw [fill=black] circle (0.05);
        \draw [dashed] (-1.5,0) -- (0,0) node [pos=0.5, below] {$a$};
        \draw [dashed] (0,0) -- (0,1) node [pos=0.5, right] {$b$};
        \draw [dotted] (0,0) -- (1.5,0);
        \draw [dotted] (0,0) -- (0,-1);
      }\cr
      $A = \pi ab$\cr
    }}}%
  }
  \NewEntry{kite}{
    \int@incr@N\l@plane@geom@int
    \tl@put@right@Nn\l@plane@geom@tl{\vbox{\halign{%
      \hfil\vphantom{$\frac\strut\strut$}#\hfil\cr
      \tikz [baseline={(kite.base)}] {
        \useasboundingbox (-1, -1.2) rectangle (2.2, 1.2);
        \draw (0,0) node(kite){};
        \draw (-0.7,0)
          -- (0,-1)
          -- (2,0)
          -- (0,1)
          -- cycle;
        \draw [dashed] (-0.7,0) -- (2,0) node [pos=0.5, below] {$q$};
        \draw [dashed] (0,-1) -- (0,1) node [pos=0.7, right] {$p$}
      }\cr
      $A = \frac12pq$\cr
    }}}%
  }
  \NewEntry{polygon}{
    \int@incr@N\l@plane@geom@int
    \tl@put@right@Nn\l@plane@geom@tl{\vbox{\halign{%
      \hfil\vphantom{$\frac\strut\strut$}#\hfil\cr
      \tikz [baseline={(pentagon.base)}] {
        \useasboundingbox (-1, -1.15) rectangle (1, 1);
        \draw [fill=black] (0,0) circle (0.05) node(pentagon){};
        \draw
            (90 + 7*360/11 - 360/22 : {cos(360/22)})
          -- (90 + 6*360/11 : 1)
          -- (90 + 5*360/11 : 1)
          -- (90 + 4*360/11 : 1)
          -- (90 + 3*360/11 : 1)
          -- (90 + 2*360/11 : 1)
          -- (90 + 1*360/11 : 1)
          -- (90 - 0*360/11 : 1)
          -- (90 - 1*360/11 : 1)
          -- (90 - 2*360/11 + 360/22 : {cos(360/22)});
        \draw [dash pattern=on 1.2pt off 1.5pt]
            (90 + 7*360/11 - 360/22 : {cos(360/22)})
          -- (90 + 7*360/11 : 1)
          -- (90 + 8*360/11 - 360/22 : {cos(360/22)})
            (90 - 2*360/11 + 360/22 : {cos(360/22)})
          -- (90 - 2*360/11 : 1)
          -- (90 - 3*360/11 + 360/22 : {cos(360/22)});
        \node at (90 - 3*360/11 : 0.95) [rotate=-3*360/11] {$\scriptstyle\cdots$};
        \node at (90 - 3*360/11 : 1) [anchor=-90-3*360/11] {$n$};
        \draw [dashed] (0, 0) -- (-90 : {cos(360/22)}) node [pos=0.5, right] {$a$};
        \draw [ultra thick]
            (90 + 2*360/11 : 1)
          -- (90 + 1*360/11 : 1) node [pos=0.5, anchor=-90+1.5*360/11] {$s$};
      }\cr
      $\vcenter{\halign{%
        \hfil\strut$#$\hfil\cr
        A = \frac12aP\cr
        P = ns\cr
      }}$\cr
    }}}%
  }
  \NewPostamble{%
    \tl@put@right@Nn\l@plane@geom@tl{\end{tabular}}%
    \int@compare@nNnTF{\l@plane@geom@int}>{1}
      {\tl@put@left@Nn\l@plane@geom@tl{\begin{tabular}{c|c|c}}}
      {\tl@put@left@Nn\l@plane@geom@tl{\begin{tabular}{c}}}%
    \tl@use@N\l@plane@geom@tl
  }
}
\makeatother
\NewFactoid{plane geom}{\Factoid{2d geom}}
\NewFactoid{plane geometry}{\Factoid{2d geom}}
